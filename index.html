<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>雨量マップ表示</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- LeafletのCSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  const apiKey = "1e0037b35b9c3f8906cc222beac04c04";

  const map = L.map('map').setView([35.4, 136.85], 10); // 岐阜中心

  // OpenStreetMapのタイル追加
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // 雨量取得＆マーカー表示関数
  function addRainMarker(lat, lon, name) {
    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}&lang=ja`)
      .then(response => response.json())
      .then(data => {
        const rain = data.rain ? data.rain['1h'] || 0 : 0;
        const popupText = `${name}<br>現在の雨量: ${rain} mm/h`;

        L.marker([lat, lon]).addTo(map)
          .bindPopup(popupText);
      })
      .catch(error => {
        console.error(`${name} のデータ取得失敗`, error);
      });
  }

  // 観測地点ごとの表示
  addRainMarker(35.380680, 136.876455, "木曽川右岸管理事務所");
  addRainMarker(35.42, 136.76, "岐阜市");

  // ▼ 警報・通行止め等を表示する場合は以下に追加
  // L.circle(...), L.polyline(...), L.marker(...), .bindPopup(...) など

</script>
  <script>
    // ▼ 気象警報・注意報 ▼
    fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=35.42&lon=136.76&exclude=hourly,daily&appid=${apiKey}&lang=ja`)
      .then(response => response.json())
      .then(data => {
        if (data.alerts) {
          data.alerts.forEach(alert => {
            const alertType = alert.event;
            const alertDescription = alert.description;
            const alertSeverity = alert.severity;

            // マーカーを地図に追加
            L.marker([35.42, 136.76], {
              icon: L.divIcon({
                className: "traffic-icon",
                html: "⚠️",
                iconSize: [20, 20]
              })
            })
            .addTo(map)
            .bindPopup(`<b>警報/注意報</b><br>${alertType}<br>${alertDescription}`);
          });
        }
      });
  </script>
</body>
</html>

